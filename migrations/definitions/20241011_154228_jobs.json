{"schemas":"--- original\n+++ modified\n@@ -12,7 +12,58 @@\n DEFINE FIELD OVERWRITE slots.*.jobs ON event TYPE array<record<job>> VALUE <set>($value);\n DEFINE FIELD OVERWRITE slots.*.jobs.* ON event TYPE record<job> ASSERT record::exists($value);\n\n+# -- Roles\n+DEFINE TABLE OVERWRITE job_role SCHEMAFULL;\n+DEFINE FIELD OVERWRITE name ON job_role TYPE string;\n+DEFINE FIELD OVERWRITE number ON job_role TYPE number;\n+\n+-- Sub Roles\n+DEFINE TABLE OVERWRITE job_sub_role SCHEMAFULL;\n+DEFINE FIELD OVERWRITE name ON job_sub_role TYPE string;\n+DEFINE FIELD OVERWRITE number ON job_sub_role TYPE number;\n+DEFINE FIELD OVERWRITE role ON job_sub_role TYPE record<job_role>;\n+\n+-- Jobs\n+DEFINE TABLE OVERWRITE job SCHEMAFULL;\n+DEFINE FIELD OVERWRITE name ON job TYPE string;\n+DEFINE FIELD OVERWRITE number ON job TYPE number;\n+DEFINE FIELD OVERWRITE sub_role ON job TYPE record<job_sub_role>;\n+\n+-- Role view\n+DEFINE TABLE OVERWRITE job_role_view TYPE NORMAL AS\n+SELECT *, id.id() as code,\n+    (\n+        SELECT *, id.id() as code,\n+            (\n+                SELECT *, id.id() as code\n+                FROM job WHERE sub_role = $parent.id ORDER BY number\n+            ) as jobs\n+        FROM job_sub_role WHERE role = $parent.id ORDER BY number\n+    ) as sub_roles\n+FROM job_role;\n+-- Member\n+DEFINE TABLE OVERWRITE member SCHEMAFULL;\n+\n+DEFINE FIELD OVERWRITE name ON member TYPE string;\n+DEFINE FIELD OVERWRITE avatar ON member TYPE string;\n+-- First time active with MiniBell timestamp\n+DEFINE FIELD OVERWRITE actived_at ON member TYPE datetime VALUE time::now() READONLY;\n+-- Joined in Discord guid timestamp\n+DEFINE FIELD OVERWRITE joined_at ON member TYPE datetime;\n+-- Last update information from Discord server \n+DEFINE FIELD OVERWRITE updated_at ON member TYPE datetime VALUE time::now();\n+DEFINE FIELD OVERWRITE roles ON member TYPE array<number>;\n+\n DEFINE TABLE OVERWRITE script_migration SCHEMAFULL;\n\n DEFINE FIELD OVERWRITE script_name ON script_migration TYPE string;\n DEFINE FIELD OVERWRITE executed_at ON script_migration TYPE datetime VALUE time::now() READONLY;\n+\n+DEFINE TABLE OVERWRITE session SCHEMAFULL;\n+\n+DEFINE FIELD OVERWRITE member ON session TYPE record<member> ASSERT record::exists($value);\n+DEFINE FIELD OVERWRITE issued_at ON session TYPE datetime READONLY;\n+DEFINE FIELD OVERWRITE updated_at ON session TYPE datetime;\n+DEFINE FIELD OVERWRITE expires_at ON session TYPE datetime;\n+\n+DEFINE INDEX OVERWRITE session_member_idx ON TABLE session COLUMNS member;\n","events":null}